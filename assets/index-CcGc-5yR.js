const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CustomizationControls-COXoM3Q0.js","assets/vendor-react-B2w3-L9B.js","assets/vendor-others-BMCg7Dc0.js","assets/vendor-three-C2pkf4WP.js","assets/vendor-react-dom-DoMX-Mzc.js","assets/vendor-zustand-Dzd9Dd--.js","assets/ChatInterface--Mt9JK1Q.js","assets/WelcomeScreen-D0L850mz.js"])))=>i.map(i=>d[i]);
import{j as e,a as i}from"./vendor-react-B2w3-L9B.js";import{c as oe}from"./vendor-react-dom-DoMX-Mzc.js";import{B as f,S as re,C as $,_ as J,a as ne,O as ae,b as ie}from"./vendor-others-BMCg7Dc0.js";import{n as P}from"./vendor-three-C2pkf4WP.js";import"./vendor-zustand-Dzd9Dd--.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&t(h)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();const ce=({headType:s,color:c,position:a=[0,0,0]})=>{const t=new P({color:c});return e.jsxs("group",{position:a,children:[s==="Head A"&&e.jsx(f,{args:[.6,.6,.6],material:t,castShadow:!0}),s==="Head B"&&e.jsx(re,{args:[.4,32,32],material:t,castShadow:!0}),s==="Head C"&&e.jsx(f,{args:[.7,.5,.5],material:t,castShadow:!0}),!["Head A","Head B","Head C"].includes(s)&&e.jsx(f,{args:[.5,.5,.5],material:t,castShadow:!0})]})},le=({torsoType:s,color:c,position:a=[0,0,0]})=>{const t=new P({color:c});return e.jsxs("group",{position:a,children:[s==="Torso A"&&e.jsx(f,{args:[.8,1,.5],material:t,castShadow:!0}),s==="Torso B"&&e.jsx($,{args:[.4,.4,1,32],material:t,castShadow:!0}),s==="Torso C"&&e.jsx(f,{args:[.6,1.2,.6],material:t,castShadow:!0}),!["Torso A","Torso B","Torso C"].includes(s)&&e.jsx(f,{args:[.7,1,.5],material:t,castShadow:!0})]})},de=({color:s,position:c=[0,0,0]})=>{const a=new P({color:s}),t=.2,o=.8,r=.2;return e.jsxs("group",{position:c,children:[e.jsx(f,{args:[t,o,r],material:a,position:[-.5,0,0],castShadow:!0}),e.jsx(f,{args:[t,o,r],material:a,position:[.5,0,0],castShadow:!0})]})},he=({legType:s,color:c,position:a=[0,0,0]})=>{const t=new P({color:c}),o=.25,r=1,h=.25,u=.2;return e.jsxs("group",{position:a,children:[s==="Legs A"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{args:[o,r,h],material:t,position:[-.2,0,0],castShadow:!0}),e.jsx(f,{args:[o,r,h],material:t,position:[u,0,0],castShadow:!0})]}),s==="Legs B"&&e.jsxs(e.Fragment,{children:[e.jsx($,{args:[o*.6,o*.6,r,16],material:t,position:[-.2,0,0],castShadow:!0}),e.jsx($,{args:[o*.6,o*.6,r,16],material:t,position:[u,0,0],castShadow:!0})]}),!["Legs A","Legs B"].includes(s)&&e.jsxs(e.Fragment,{children:[e.jsx(f,{args:[o,r,h],material:t,position:[-.2,0,0],castShadow:!0}),e.jsx(f,{args:[o,r,h],material:t,position:[u,0,0],castShadow:!0})]})]})},ue=i.lazy(()=>J(()=>import("./CustomizationControls-COXoM3Q0.js"),__vite__mapDeps([0,1,2,3,4,5]))),pe=i.lazy(()=>J(()=>import("./ChatInterface--Mt9JK1Q.js"),__vite__mapDeps([6,1,2,3,4,5]))),ge=i.lazy(()=>J(()=>import("./WelcomeScreen-D0L850mz.js"),__vite__mapDeps([7,1,2,3,4,5]))),A=["Head A","Head B","Head C"],R=["Torso A","Torso B","Torso C"],M=["Arms A","Arms B"],E=["Legs A","Legs B"],x=["#ff6347","#4682b4","#32cd32","#ffd700","#8a2be2"],v="aiPartnerSimulatorConfig",fe=s=>(s=s.replace(/(\*\*|__)(.*?)\1/g,"$2"),s=s.replace(/(\*|_)(.*?)\1/g,"$2"),s=s.replace(/^#+\s*/gm,""),s=s.replace(/\[(.*?)\]\(.*?\)/g,"$1"),s=s.replace(/`(.*?)`/g,"$1"),s=s.replace(/```[\s\S]*?```/g,""),s=s.replace(/^(---|___|\*\*\*)\s*$/gm,""),s=s.replace(/^>\s*/gm,""),s=s.replace(/^(\*|-|\+)\s+/gm,""),s=s.replace(/\n{2,}/g,`
`),s.trim()),me=({config:s,isSpeaking:c})=>{const a=i.useRef(null),t=i.useRef(null),o=1.1,r=.6,h=1,u=o/2+r/2-.1,H=0,m=-1.05+.1,y=h/2-m;return ie(({clock:j})=>{const O=j.getElapsedTime();if(a.current&&(a.current.position.y=y+Math.sin(O*2)*.05),t.current)if(c){const I=1+Math.sin(O*15)*.05;t.current.scale.set(I,I,I)}else t.current.scale.set(1,1,1)}),e.jsxs("group",{ref:a,position:[0,y,0],children:[e.jsxs("group",{ref:t,position:[0,u,0],children:[e.jsx(ce,{headType:s.head,color:s.color,position:[0,0,0]})," "]}),e.jsx(le,{torsoType:s.torso,color:s.color,position:[0,0,0]}),e.jsx(de,{armType:s.arms,color:s.color,position:[0,H,0]}),e.jsx(he,{legType:s.legs,color:s.color,position:[0,m,0]})]})};function Se(){const[s,c]=i.useState(!1),[a,t]=i.useState(()=>{const l=localStorage.getItem(v);let g=null;if(l)try{const n=JSON.parse(l);if(n.head&&n.torso&&n.arms&&n.legs&&n.color&&A.includes(n.head)&&R.includes(n.torso)&&M.includes(n.arms)&&E.includes(n.legs)&&x.includes(n.color))return g=n,g}catch(n){console.error("Failed to parse saved config:",n)}return{head:A[0],torso:R[0],arms:M[0],legs:E[0],color:x[0]}});i.useEffect(()=>{localStorage.getItem(v)&&c(!0)},[]),i.useEffect(()=>{s&&localStorage.setItem(v,JSON.stringify(a))},[a,s]);const[o,r]=i.useState([]),[h,u]=i.useState(!1),[H,m]=i.useState(!1),y=i.useRef(0),j=i.useRef(null),O=()=>(y.current+=1,`msg-${y.current}`),B=l=>{if("speechSynthesis"in window){window.speechSynthesis.cancel();const g=fe(l),n=new SpeechSynthesisUtterance(g);n.rate=1.5,n.onstart=()=>{console.log("Speech started"),m(!0)},n.onend=()=>{console.log("Speech ended"),m(!1),u(!1),j.current=null},n.onerror=S=>{console.error("Speech synthesis error:",S.error),m(!1),u(!1),j.current=null},j.current=n,window.speechSynthesis.speak(n)}else console.warn("Web Speech Synthesis API not supported by this browser."),u(!1)},N=(l,g)=>{t(n=>{const w=(g.indexOf(n[l])+1)%g.length;return{...n,[l]:g[w]}}),"speechSynthesis"in window&&(window.speechSynthesis.cancel(),m(!1))},I=()=>{t(l=>{const n=(x.indexOf(l.color)+1)%x.length;return{...l,color:x[n]}}),"speechSynthesis"in window&&(window.speechSynthesis.cancel(),m(!1))},X=()=>{const l=A[Math.floor(Math.random()*A.length)],g=R[Math.floor(Math.random()*R.length)],n=M[Math.floor(Math.random()*M.length)],S=E[Math.floor(Math.random()*E.length)],w=x[Math.floor(Math.random()*x.length)];t({head:l,torso:g,arms:n,legs:S,color:w}),"speechSynthesis"in window&&(window.speechSynthesis.cancel(),m(!1))},ee=()=>{s?(localStorage.setItem(v,JSON.stringify(a)),alert("Configuration saved!")):alert("Cannot save before starting customization.")},se=async l=>{var W,Y,G,V;const n={id:O(),sender:"user",text:l,timestamp:Date.now()};r(p=>[...p,n]),"speechSynthesis"in window&&(window.speechSynthesis.cancel(),m(!1)),u(!0);const S=O();let w="";r(p=>[...p,{id:S,sender:"bot",text:"...",timestamp:Date.now()}]);try{const p=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"gemini-2.5-pro-exp-03-25",messages:[{role:"user",content:l}],stream:!0})});if(!p.ok){let b="Failed to start stream.";try{const d=await p.json();console.error("API Error Response:",d),b=((W=d==null?void 0:d.error)==null?void 0:W.message)||(d==null?void 0:d.error)||(d==null?void 0:d.message)||JSON.stringify(d)}catch{b=`API request failed with status ${p.status}`,console.error("API Error: Status",p.status,await p.text())}r(d=>d.map(_=>_.id===S?{..._,text:`Error: ${b}`}:_)),u(!1);return}if(!p.body)throw new Error("Response body is null");const k=p.body.getReader(),C=new TextDecoder("utf-8");let z=!1,q="";for(;!z;){const{value:b,done:d}=await k.read();z=d;const _=C.decode(b,{stream:!0}),K=(q+_).split(`
`);q=K.pop()||"";for(const U of K)if(U.startsWith("data:")){const D=U.substring(5).trim();if(D==="[DONE]"){z=!0;break}try{const Q=(V=(G=(Y=JSON.parse(D).choices)==null?void 0:Y[0])==null?void 0:G.delta)==null?void 0:V.content;Q&&(w+=Q,r(L=>{const F=L.findIndex(T=>T.id===S);if(F!==-1){const T=[...L];return T[F]={...L[F],text:w},T}return L}))}catch(Z){console.error("Failed to parse stream data chunk:",D,Z)}}}w&&B(w)}catch(p){console.error("Network or Fetch Error:",p),r(k=>k.map(C=>C.id===S?{...C,text:"Error: Could not reach the chat service."}:C)),u(!1)}finally{u(!1)}},te=()=>{c(!0)};return s?e.jsxs("div",{style:{display:"flex",width:"100vw",height:"100vh"},children:[e.jsx("div",{style:{flex:"0 0 70%",height:"100%",background:"#282c34",position:"relative"},children:e.jsxs(ne,{shadows:!0,camera:{position:[0,2,5],fov:75},children:[e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[10,10,5],intensity:1,castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024}),e.jsx("pointLight",{position:[-10,-10,-10],intensity:.5}),e.jsx(me,{config:a,isSpeaking:H}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,0,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[20,20]}),e.jsx("meshStandardMaterial",{color:"#555"})]}),e.jsx(ae,{enablePan:!0,enableZoom:!0,enableRotate:!0,target:[0,1.5,0]})]})}),e.jsx("div",{style:{flex:"0 0 30%",height:"100%",borderLeft:"1px solid #ccc",display:"flex",flexDirection:"column"},children:e.jsxs(i.Suspense,{fallback:e.jsx("div",{children:"Loading UI..."}),children:[e.jsx("div",{style:{flex:"0 0 auto",borderBottom:"1px solid #ccc"},children:e.jsx(ue,{config:a,headOptions:A,torsoOptions:R,armOptions:M,legOptions:E,colorOptions:x,onCycleOption:N,onCycleColor:I,onRandomize:X,onSaveConfig:ee})}),e.jsx("div",{style:{flex:"1 1 auto",minHeight:0},children:e.jsx(pe,{messages:o,onSendMessage:se,isBotTyping:h})})]})})]}):e.jsx(i.Suspense,{fallback:e.jsx("div",{children:"Loading Welcome Screen..."}),children:e.jsx(ge,{onStart:te})})}oe.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Se,{})}));
